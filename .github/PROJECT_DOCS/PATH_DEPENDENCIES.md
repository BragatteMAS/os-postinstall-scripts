# üìç Path Dependencies Analysis

> **Generated:** 2025-07-25 | **Purpose:** Document all path dependencies before restructuring

## üîç Summary of Findings

### Critical Path Dependencies

1. **Source Commands**
   - `utils/logging.sh` - sourced by multiple scripts
   - `utils/package-manager-safety.sh` - critical for APT operations
   - `utils/profile-loader.sh` - used by setup-with-profile.sh

2. **Relative Path Navigation**
   - Multiple scripts use `../..` to find ROOT_DIR
   - Common pattern: `ROOT_DIR="$(cd "$SCRIPT_DIR/../.." && pwd)"`

3. **Direct Directory References**
   - setup.sh ‚Üí linux/post_install.sh
   - tests ‚Üí utils/ and linux/ directories
   - No direct script references in profile YAMLs

## üìä Dependency Matrix

| File | Dependencies | Type |
|------|-------------|------|
| setup.sh | linux/post_install.sh | Direct execution |
| setup-with-profile.sh | utils/profile-loader.sh | Source |
| install_ai_tools.sh | utils/logging.sh | Source |
| linux/post_install.sh | utils/package-manager-safety.sh | Source |
| linux/install/apt.sh | utils/package-manager-safety.sh | Source |
| tests/security/*.sh | utils/*.sh, linux/*.sh | Source & validation |

## üö® High-Risk Changes

These paths CANNOT be changed without breaking functionality:

1. **utils/logging.sh** - Required by:
   - install_ai_tools.sh
   - utils/profile-loader.sh
   - utils/package-manager-safety.sh
   - linux/verify/check-installation.sh

2. **utils/package-manager-safety.sh** - Required by:
   - setup-with-profile.sh
   - linux/post_install.sh
   - linux/install/apt.sh
   - tests/security/test_apt_lock_safety.sh

3. **linux/** directory structure - Referenced by:
   - setup.sh (hardcoded paths)
   - All test scripts
   - CI/CD workflows

## ‚úÖ Safe to Change

These have minimal dependencies:

1. **docs/** - Only referenced in documentation
2. **.github/** - Self-contained
3. **Individual script names** (with redirects)

## üîÑ Migration Strategy

### Phase 1: Create Compatibility Layer
```bash
# Create new structure
mkdir -p lib

# Symlink for backward compatibility
ln -s ../utils lib/utils

# Add deprecation notice
echo "# DEPRECATED: utils/ will move to lib/ in v3.0.0" >> utils/README.md
```

### Phase 2: Update Scripts Gradually
```bash
# Old way
source "${SCRIPT_DIR}/utils/logging.sh"

# New way (with fallback)
if [[ -f "${SCRIPT_DIR}/lib/utils/logging.sh" ]]; then
    source "${SCRIPT_DIR}/lib/utils/logging.sh"
else
    source "${SCRIPT_DIR}/utils/logging.sh"  # Fallback
fi
```

### Phase 3: Update Documentation
- Update all paths in docs/
- Update examples
- Create migration guide

## üõ°Ô∏è Testing Requirements

Before ANY path changes:

1. Run full test suite
2. Test on all OS (Linux, macOS, Windows)
3. Test all profiles
4. Verify CI/CD still works
5. Test with fresh clone

## üìù Notes

- Profile YAMLs don't contain script paths (good design!)
- Most dependencies are in bash scripts via `source`
- ROOT_DIR pattern is used consistently
- Tests are tightly coupled to current structure

---

**Generated by:** Path dependency analyzer  
**Next Step:** Create detailed migration plan (ADR-009)
---
phase: 08.2-audit-remediation
plan: 03
subsystem: shell-scripts
tags: [dry-run, curl-pipe, powershell, windows, terminal-setup]

# Dependency graph
requires:
  - phase: 08.1-terminal-setup-windows
    provides: terminal-setup.sh and Windows main.ps1 orchestrator
provides:
  - DRY_RUN-safe curl|sh pipelines in terminal-setup.sh
  - WARN-level logging for unimplemented Windows dispatchers
affects: []

# Tech tracking
tech-stack:
  added: []
  patterns:
    - "Explicit DRY_RUN guard before curl|sh pipelines (not run() wrapper)"
    - "WARN-level logging for known-unimplemented package dispatchers"

key-files:
  created: []
  modified:
    - examples/terminal-setup.sh
    - src/platforms/windows/main.ps1

key-decisions:
  - "Direct if/else DRY_RUN guard instead of run() wrapper for curl|sh pipes"
  - "WARN (not ERROR) for unimplemented Windows dispatchers â€” gap is known, not broken"
  - "Keep default case at DEBUG for truly unrelated files (apt.txt, brew.txt)"

patterns-established:
  - "curl|sh guard: explicit DRY_RUN check wrapping entire pipeline, not run() on left side"
  - "Known-gap logging: WARN level for dispatchers that exist on other platforms but not current"

# Metrics
duration: 1min
completed: 2026-02-08
---

# Phase 8.2 Plan 03: Dry-Run Fix and Windows WARN Summary

**DRY_RUN guards on 2 curl|sh pipelines in terminal-setup.sh + WARN logging for 3 unimplemented Windows dispatchers in main.ps1**

## Performance

- **Duration:** 1 min
- **Started:** 2026-02-08T21:14:35Z
- **Completed:** 2026-02-08T21:15:41Z
- **Tasks:** 2
- **Files modified:** 2

## Accomplishments
- terminal-setup.sh zoxide and starship curl|sh pipelines now properly skip in dry-run mode
- Windows main.ps1 explicitly warns users when cargo.txt, npm.txt, ai-tools.txt appear in profiles
- Both fixes are minimal, targeted changes with no scope creep

## Task Commits

Each task was committed atomically:

1. **Task 1: Fix terminal-setup.sh dry-run bypass for curl|sh** - `cd7d3d2` (fix)
2. **Task 2: Add WARN logging for cross-platform files in Windows main.ps1** - `e0c71f3` (fix)

## Files Created/Modified
- `examples/terminal-setup.sh` - Replaced `run curl ... | sh` with explicit DRY_RUN if/else guards for zoxide and starship installers
- `src/platforms/windows/main.ps1` - Added cargo.txt, npm.txt, ai-tools.txt switch cases with WARN-level skip messages

## Decisions Made
- Used explicit `if [[ "${DRY_RUN:-}" == "true" ]]` guard wrapping the entire curl|sh pipeline rather than trying to fix `run()` -- the `run()` wrapper fundamentally cannot guard the right side of a pipe
- Chose WARN level (not ERROR) for Windows unimplemented dispatchers because the gap is intentional and known, not a failure condition
- Kept the `default` case at DEBUG level for truly unrelated platform files (apt.txt, brew.txt, etc.)

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered

None

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness
- terminal-setup.sh dry-run bypass (audit item 5) resolved
- Windows main.ps1 silent skip (audit item 3, partial) resolved
- Remaining Phase 8.2 items: post_install.sh deprecation, test coverage expansion, homebrew exit codes, cross-process failure tracking, CODE_OF_CONDUCT

---
*Phase: 08.2-audit-remediation*
*Completed: 2026-02-08*

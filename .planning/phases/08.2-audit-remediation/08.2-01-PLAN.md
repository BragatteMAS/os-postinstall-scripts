---
phase: 08.2-audit-remediation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/platforms/linux/post_install.sh
  - tests/test_harness.sh
  - CODE_OF_CONDUCT.md
autonomous: true

must_haves:
  truths:
    - "Running post_install.sh prints deprecation notice and exits 0"
    - "test_harness.sh passes with the deprecated post_install.sh"
    - "CODE_OF_CONDUCT.md exists with Contributor Covenant v2.1 content"
  artifacts:
    - path: "src/platforms/linux/post_install.sh"
      provides: "Deprecation wrapper"
      contains: "DEPRECATED"
    - path: "tests/test_harness.sh"
      provides: "Updated test harness"
      contains: "DEPRECATED"
    - path: "CODE_OF_CONDUCT.md"
      provides: "Code of Conduct"
      contains: "Contributor Covenant"
  key_links:
    - from: "tests/test_harness.sh"
      to: "src/platforms/linux/post_install.sh"
      via: "test_script_exists check"
      pattern: "post_install.sh"
---

<objective>
Deprecate post_install.sh in-place and create CODE_OF_CONDUCT.md.

Purpose: Eliminate the most dangerous legacy file (10+ bugs, deprecated apt-key, chmod 777, HOME overwrite) by replacing it with a thin deprecation wrapper. Create the missing community health file deferred from Phase 8.
Output: post_install.sh as deprecation notice, updated test_harness.sh, CODE_OF_CONDUCT.md
</objective>

<execution_context>
@/Users/bragatte/.claude/get-shit-done/workflows/execute-plan.md
@/Users/bragatte/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/platforms/linux/post_install.sh
@tests/test_harness.sh
</context>

<tasks>

<task type="auto">
  <name>Task 1: Deprecate post_install.sh in-place</name>
  <files>src/platforms/linux/post_install.sh</files>
  <action>
Replace the ENTIRE contents of `src/platforms/linux/post_install.sh` with a deprecation wrapper. The new file must:

1. Keep the `#!/usr/bin/env bash` shebang
2. Include a comment block explaining this file is deprecated and why
3. Print a clear deprecation notice to stdout directing users to `./setup.sh` or `src/platforms/linux/main.sh`
4. Exit 0 (backward-compatible for any scripts that call this)

The wrapper should be approximately 15-20 lines. Do NOT import any core modules, source any files, or do anything besides echo and exit. The notice should include:
- Clear `[DEPRECATED]` prefix
- What to use instead: `./setup.sh` (interactive) or `./setup.sh developer` (unattended)
- A note that this file will be removed in a future release
- See README.md for full usage

Also update `tests/test_harness.sh`:
- Line 57 checks `test_script_exists "src/platforms/linux/post_install.sh"` -- keep this (file still exists)
- Line 77 checks `test_script_executable "src/platforms/linux/post_install.sh"` -- keep this (file is still executable)
- Add a NEW test in the "Shell Script Quality Tests" section (after line 79, where content checks live). The test verifies the deprecation notice is present: check that `grep -q "DEPRECATED" src/platforms/linux/post_install.sh` passes. Use the existing `pass`/`fail` helper pattern, e.g.:
  ```bash
  if grep -q "DEPRECATED" src/platforms/linux/post_install.sh; then
      pass "post_install.sh has deprecation notice"
  else
      fail "post_install.sh missing deprecation notice"
  fi
  ```
  Place this AFTER the shebang tests and BEFORE any other quality tests. Do NOT put it between file existence tests (lines 51-58) â€” it's a content check, not an existence check.

Do NOT change any other tests in test_harness.sh. The file existence and executable checks should still pass because the file is retained.
  </action>
  <verify>
Run: `bash -n src/platforms/linux/post_install.sh` (syntax check)
Run: `grep -q "DEPRECATED" src/platforms/linux/post_install.sh` (deprecation present)
Run: `bash src/platforms/linux/post_install.sh` (should print notice and exit 0)
Run: `bash -n tests/test_harness.sh` (test harness syntax valid)
  </verify>
  <done>post_install.sh prints deprecation notice and exits 0. test_harness.sh validates the deprecation notice is present.</done>
</task>

<task type="auto">
  <name>Task 2: Create CODE_OF_CONDUCT.md</name>
  <files>CODE_OF_CONDUCT.md</files>
  <action>
Create `CODE_OF_CONDUCT.md` in the project root using the Contributor Covenant v2.1 template.

The file must:
1. Use the standard Contributor Covenant v2.1 markdown (https://www.contributor-covenant.org/version/2/1/code_of_conduct/code_of_conduct.md)
2. Set contact method to: a GitHub Issues link (`https://github.com/BragatteMAS/os-postinstall-scripts/issues`)
3. Include the standard sections: Our Pledge, Our Standards, Enforcement Responsibilities, Scope, Enforcement, Enforcement Guidelines, Attribution
4. Keep the Attribution section linking to the Contributor Covenant homepage

This is a standard community health file. Use the canonical template text verbatim except for the contact method placeholder.
  </action>
  <verify>
Run: `test -f CODE_OF_CONDUCT.md && echo "EXISTS" || echo "MISSING"`
Run: `grep -q "Contributor Covenant" CODE_OF_CONDUCT.md`
Run: `grep -q "2.1" CODE_OF_CONDUCT.md`
  </verify>
  <done>CODE_OF_CONDUCT.md exists with Contributor Covenant v2.1 content and project-specific contact info.</done>
</task>

</tasks>

<verification>
1. `bash -n src/platforms/linux/post_install.sh` passes (valid syntax)
2. `bash src/platforms/linux/post_install.sh` prints DEPRECATED notice and exits 0
3. `bash -n tests/test_harness.sh` passes (valid syntax)
4. `test -f CODE_OF_CONDUCT.md` passes
5. `grep -q "Contributor Covenant" CODE_OF_CONDUCT.md` passes
6. `wc -l < src/platforms/linux/post_install.sh` is less than 30 (thin wrapper, not legacy code)
</verification>

<success_criteria>
- post_install.sh is a thin deprecation wrapper (< 30 lines, no imports, no installs)
- test_harness.sh validates the deprecation notice
- CODE_OF_CONDUCT.md exists with Contributor Covenant v2.1
</success_criteria>

<output>
After completion, create `.planning/phases/08.2-audit-remediation/08.2-01-SUMMARY.md`
</output>

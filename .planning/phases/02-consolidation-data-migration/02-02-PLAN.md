---
phase: 02-consolidation-data-migration
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - data/packages/apt.txt
  - data/packages/brew.txt
  - data/packages/brew-cask.txt
  - data/packages/cargo.txt
  - data/packages/npm.txt
  - data/packages/winget.txt
  - data/packages/ai-tools.txt
  - data/packages/profiles/minimal.txt
  - data/packages/profiles/developer.txt
  - data/packages/profiles/full.txt
autonomous: true

must_haves:
  truths:
    - "Package lists exist as .txt files in data/packages/"
    - "Each file has one package per line with comments supported"
    - "Profile files list other package files to include"
  artifacts:
    - path: "data/packages/apt.txt"
      provides: "APT package list"
      min_lines: 10
    - path: "data/packages/cargo.txt"
      provides: "Cargo tools list"
      min_lines: 5
    - path: "data/packages/profiles/developer.txt"
      provides: "Developer profile composition"
      contains: "apt.txt"
  key_links:
    - from: "data/packages/profiles/developer.txt"
      to: "data/packages/apt.txt"
      via: "profile include"
      pattern: "apt.txt"
---

<objective>
Extract hardcoded package arrays from scripts into data/packages/*.txt files

Purpose: Separate data from code. Package lists become editable without touching scripts.
Output: Complete set of package list files under data/packages/
</objective>

<execution_context>
@/Users/bragatte/.claude/get-shit-done/workflows/execute-plan.md
@/Users/bragatte/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-consolidation-data-migration/02-CONTEXT.md
@.planning/phases/02-consolidation-data-migration/02-RESEARCH.md
@.planning/phases/02-consolidation-data-migration/02-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extract package lists from scripts to .txt files</name>
  <files>
    data/packages/apt.txt
    data/packages/brew.txt
    data/packages/brew-cask.txt
    data/packages/cargo.txt
    data/packages/npm.txt
    data/packages/winget.txt
    data/packages/ai-tools.txt
  </files>
  <action>
    1. Search for hardcoded package arrays in scripts:
       - rg -A 20 'APT_INSTALL=|APT_PACKAGES=' --type sh
       - rg -A 20 'RUST_TOOLS=|CARGO_PACKAGES=' --type sh
       - rg -A 20 'BREW_PACKAGES=|BREW_CASKS=' --type sh
       - rg -A 20 'NPM_PACKAGES=|NPM_GLOBAL=' --type sh
       - rg -A 20 'AI_TOOLS=|MCP_TOOLS=' --type sh

    2. Create data/packages/apt.txt:
       - Extract packages from platforms/linux/install/*.sh
       - One package per line
       - Group with comments (# Core utilities, # Development, etc.)
       - Include: git, git-lfs, curl, wget, zsh, htop, build-essential, cmake, etc.

    3. Create data/packages/cargo.txt:
       - Extract from scripts/install/rust-tools.sh
       - Include: bat, eza, fd-find, ripgrep, zoxide, delta, starship, etc.

    4. Create data/packages/brew.txt and brew-cask.txt:
       - Extract from platforms/macos/ scripts (even if partial)
       - Formulae in brew.txt, Casks in brew-cask.txt

    5. Create data/packages/npm.txt:
       - Extract global npm packages
       - Include any found in scripts or reasonable defaults

    6. Create data/packages/winget.txt:
       - Extract from platforms/windows/ scripts
       - Include packages from win11.ps1 if applicable

    7. Create data/packages/ai-tools.txt:
       - Extract from scripts/install/ai-tools.sh
       - Include MCP tools, Claude CLI, etc.

    Format for all files:
    ```
    # Category name
    package-name
    another-package

    # Another category
    more-packages
    ```
  </action>
  <verify>
    - ls data/packages/*.txt shows 7 files
    - wc -l data/packages/*.txt shows lines in each
    - head -20 data/packages/apt.txt shows proper format
    - head -20 data/packages/cargo.txt shows proper format
  </verify>
  <done>
    All package lists exist as .txt files with comments and proper formatting
  </done>
</task>

<task type="auto">
  <name>Task 2: Create profile composition files</name>
  <files>
    data/packages/profiles/minimal.txt
    data/packages/profiles/developer.txt
    data/packages/profiles/full.txt
  </files>
  <action>
    1. Create data/packages/profiles/minimal.txt:
       - Lists only apt.txt (essential system packages)
       ```
       # Minimal profile - essential system packages only
       apt.txt
       ```

    2. Create data/packages/profiles/developer.txt:
       - Includes base system + dev tools
       ```
       # Developer profile - system + development tools
       apt.txt
       cargo.txt
       npm.txt
       ```

    3. Create data/packages/profiles/full.txt:
       - Includes everything
       ```
       # Full profile - all packages including AI tools
       apt.txt
       cargo.txt
       npm.txt
       ai-tools.txt
       ```

    Profile files simply list other package files to include.
    The load_profile() function (from 02-01) reads these and combines packages.
  </action>
  <verify>
    - ls data/packages/profiles/*.txt shows 3 files
    - cat data/packages/profiles/minimal.txt shows apt.txt
    - cat data/packages/profiles/developer.txt shows 3 entries
    - cat data/packages/profiles/full.txt shows 4 entries
  </verify>
  <done>
    Three profile files exist: minimal, developer, full
  </done>
</task>

<task type="auto">
  <name>Task 3: Test package loading with new data files</name>
  <files>None (testing only)</files>
  <action>
    Create a test script inline and run:

    ```bash
    cd /Users/bragatte/Documents/GitHub/os-postinstall-scripts
    source src/core/packages.sh

    echo "=== Testing load_packages ==="
    load_packages "apt.txt"
    echo "Loaded ${#PACKAGES[@]} APT packages"
    echo "First 5: ${PACKAGES[@]:0:5}"

    echo ""
    echo "=== Testing load_profile ==="
    load_profile "developer"
    echo "Developer profile: ${#PACKAGES[@]} total packages"

    echo ""
    echo "=== Testing get_packages_for_manager ==="
    get_packages_for_manager "cargo"
    echo "Cargo packages: ${#PACKAGES[@]}"
    ```

    Verify all functions work with the new data files.
  </action>
  <verify>
    - load_packages() successfully loads apt.txt
    - load_profile() combines packages from multiple files
    - get_packages_for_manager() loads specific manager files
    - No errors during execution
  </verify>
  <done>
    Package loading system works end-to-end with data files
  </done>
</task>

</tasks>

<verification>
1. data/packages/ contains: apt.txt, brew.txt, brew-cask.txt, cargo.txt, npm.txt, winget.txt, ai-tools.txt
2. data/packages/profiles/ contains: minimal.txt, developer.txt, full.txt
3. All .txt files have proper format (comments, one package per line)
4. load_packages() and load_profile() work with new files
</verification>

<success_criteria>
- 7 package list files exist under data/packages/
- 3 profile files exist under data/packages/profiles/
- Package loading functions successfully load data from files
- Format is consistent: comments start with #, one package per line
</success_criteria>

<output>
After completion, create `.planning/phases/02-consolidation-data-migration/02-02-SUMMARY.md`
</output>

---
phase: 02-consolidation-data-migration
plan: 05
type: execute
wave: 5
depends_on: ["02-04"]
files_modified: []
autonomous: true

must_haves:
  truths:
    - "Only src/core/ contains utility implementations (single source of truth)"
    - "Project follows src/ + data/ + docs/ layout exclusively"
    - "All shell script source statements reference src/core/ or src/platforms/"
    - "data/packages/ is the only location for package list files"
  artifacts:
    - path: "src/core/"
      provides: "Single source of truth for utilities"
      contains: "logging.sh"
    - path: "data/packages/"
      provides: "Single source of truth for package lists"
      contains: "apt.txt"
  key_links:
    - from: "setup.sh"
      to: "src/core/"
      via: "source statements"
      pattern: "source.*src/core"
---

<objective>
Remove deprecated code and old directory structure

Purpose: Clean up the codebase by removing deprecated scripts/common/, old duplicate files, and empty directories. Ensure no dangling references remain.
Output: Clean project structure with only src/, data/, docs/ layout
</objective>

<execution_context>
@/Users/bragatte/.claude/get-shit-done/workflows/execute-plan.md
@/Users/bragatte/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-consolidation-data-migration/02-CONTEXT.md
@.planning/phases/02-consolidation-data-migration/02-RESEARCH.md
@.planning/phases/02-consolidation-data-migration/02-01-SUMMARY.md
@.planning/phases/02-consolidation-data-migration/02-02-SUMMARY.md
@.planning/phases/02-consolidation-data-migration/02-03-SUMMARY.md
@.planning/phases/02-consolidation-data-migration/02-04-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove scripts/common/ deprecated directory</name>
  <files>scripts/common/ (removal)</files>
  <action>
    1. Check what's in scripts/common/:
       ls -la scripts/common/

    2. Verify nothing references scripts/common/:
       rg "scripts/common" --type sh
       rg "common/install-data-tools" --type sh

    3. If no references found, remove:
       git rm -r scripts/common/

    4. If references exist, update them first:
       - Check if functionality was migrated to new location
       - Update reference to point to new location
       - Then remove old directory

    Per CONTEXT.md: scripts/common/ is deprecated and should be removed after verifying no references.
  </action>
  <verify>
    - ls scripts/common/ fails (directory removed)
    - rg "scripts/common" returns no matches
    - git status shows deletion staged
  </verify>
  <done>
    scripts/common/ directory is removed from codebase
  </done>
</task>

<task type="auto">
  <name>Task 2: Remove migrated files from old locations</name>
  <files>
    scripts/utils/ (removal after verification)
    platforms/linux/utils/ (removal - was symlinks)
    platforms/linux/auto/ (removal - packages extracted in 02-02)
  </files>
  <action>
    1. Verify scripts/utils/ files were migrated to src/core/:
       - Compare: diff scripts/utils/logging.sh src/core/logging.sh (if both exist)
       - If scripts/utils/ still exists but src/core/ has the files, remove scripts/utils/

    2. Check for remaining references to scripts/utils/:
       rg "scripts/utils" --type sh
       If references exist, they should have been updated in 02-03. Double-check.

    3. Remove scripts/utils/ if:
       - All files are in src/core/
       - No references remain
       git rm -r scripts/utils/

    4. Check platforms/linux/utils/:
       ls -la platforms/linux/utils/
       - If these were symlinks to scripts/utils/, they're now broken
       - Remove them: git rm -r platforms/linux/utils/

    5. Check platforms/linux/ for other migrated content:
       - If main.sh, post_install.sh, install/apt.sh were moved to src/platforms/linux/
       - Remove the originals from platforms/linux/

    6. Remove platforms/linux/auto/ directory:
       - Packages were extracted to data/packages/flatpak.txt and snap.txt in 02-02
       - auto/logging.sh was a broken symlink (pointed to scripts/utils/)
       - auto/ scripts use set -euo pipefail which conflicts with Phase 1 patterns
       - Verify no references: rg "platforms/linux/auto" --type sh
       - Remove: git rm -r platforms/linux/auto/
  </action>
  <verify>
    - ls scripts/utils/ fails or shows only non-migrated files
    - ls platforms/linux/utils/ fails (removed)
    - ls platforms/linux/auto/ fails (removed)
    - rg "scripts/utils" returns no matches
    - rg "platforms/linux/utils" returns no matches
    - rg "platforms/linux/auto" returns no matches
  </verify>
  <done>
    Old utility directories removed, auto/ removed (packages preserved in data/packages/), no broken symlinks
  </done>
</task>

<task type="auto">
  <name>Task 3: Clean up empty directories and verify final structure</name>
  <files>Various directories (cleanup)</files>
  <action>
    1. Remove empty directories:
       - Check if scripts/ is empty after removals: ls scripts/
       - Check if platforms/linux/ is empty: ls platforms/linux/
       - Remove empty directories: rmdir scripts (if empty) or git rm -r

    2. Check for any remaining old references:
       rg "scripts/" --type sh | grep -v ".planning"
       rg "platforms/" --type sh | grep -v ".planning" | grep -v "src/platforms"

    3. Verify final structure matches CONTEXT.md:
       ```
       ls -la
       # Should show: setup.sh, config.sh, src/, data/, docs/, .planning/, etc.

       ls src/
       # Should show: core/, platforms/

       ls src/core/
       # Should show: logging.sh, platform.sh, idempotent.sh, errors.sh, packages.sh

       ls src/platforms/
       # Should show: linux/, macos/, windows/

       ls data/
       # Should show: packages/, dotfiles/

       ls data/packages/
       # Should show: *.txt files (including flatpak.txt, snap.txt)
       ```

    4. Remove legacy migration scripts if present:
       - migrate-structure.sh
       - test_migration.sh
       - test_simple_migration.sh
       - verify-migration.sh
       - scripts/reorganize-structure.sh
       These are one-time migration helpers, not needed after phase completes.

    5. DEFERRED TO PHASE 5 - DO NOT DELETE:
       The following files in platforms/linux/install/ are intentionally kept for Phase 5 (Linux Enhancements):
       - platforms/linux/install/flatpak.sh (flatpak remote-add logic)
       - platforms/linux/install/snap.sh (snap installation logic)
       - platforms/linux/install/desktop-environments.sh
       These are "feature additions" that belong in Phase 5 scope.
       The package LISTS were extracted to data/packages/ but the INSTALLATION LOGIC remains.
  </action>
  <verify>
    - eza -T -L 2 shows clean structure without old directories
    - No empty directories remain
    - src/core/ has 5 .sh files
    - data/packages/ has .txt files
    - rg for old paths returns no matches
  </verify>
  <done>
    Project structure is clean with only new layout
  </done>
</task>

</tasks>

<verification>
1. scripts/common/ removed
2. scripts/utils/ removed (migrated to src/core/)
3. platforms/linux/utils/ removed (symlinks to old location)
4. No empty directories remain
5. No references to old paths in shell scripts
6. Project structure matches CONTEXT.md specification
</verification>

<success_criteria>
- No duplicate code exists between old and new locations
- scripts/common/ is deleted
- Old scripts/utils/ files are deleted (now in src/core/)
- Project follows src/ + data/ + docs/ layout
- All references point to new locations
</success_criteria>

<output>
After completion, create `.planning/phases/02-consolidation-data-migration/02-05-SUMMARY.md`
</output>

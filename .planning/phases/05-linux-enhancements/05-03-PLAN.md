---
phase: 05-linux-enhancements
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - src/install/rust-cli.sh
  - data/dotfiles/shared/aliases.sh
  - data/dotfiles/git/gitconfig
  - data/dotfiles/bash/bashrc
  - data/dotfiles/zsh/zshrc
autonomous: true

must_haves:
  truths:
    - "Rust CLI tools (bat, eza, fd, rg, zoxide, delta) are installed via apt on Linux, brew on macOS"
    - "Ubuntu binary name symlinks are created: batcat->bat, fdfind->fd"
    - "eza aliases include --group-directories-first flag"
    - "delta is configured as git pager in gitconfig"
    - "zoxide shell integration is sourced in bashrc and zshrc"
    - "Educational summary shows Rust tool equivalents (bat>cat, eza>ls, etc.)"
  artifacts:
    - path: "src/install/rust-cli.sh"
      provides: "Cross-platform Rust CLI tools installer"
      contains: "create_rust_symlinks"
    - path: "data/dotfiles/shared/aliases.sh"
      provides: "Updated eza aliases with --group-directories-first"
      contains: "group-directories-first"
    - path: "data/dotfiles/git/gitconfig"
      provides: "Delta pager configuration"
      contains: "delta"
  key_links:
    - from: "src/install/rust-cli.sh"
      to: "src/core/packages.sh"
      via: "load_packages()"
      pattern: "load_packages"
    - from: "src/install/rust-cli.sh"
      to: "src/core/platform.sh"
      via: "DETECTED_OS for platform branching"
      pattern: "DETECTED_OS"
---

<objective>
Create a cross-platform Rust CLI tools installer that uses apt on Linux and brew on macOS, creates Ubuntu symlinks for name divergences, updates eza aliases with --group-directories-first, adds delta configuration to gitconfig, and adds zoxide shell integration to dotfiles.

Purpose: Install modern Rust-based CLI replacements (bat>cat, eza>ls, fd>find, rg>grep, zoxide>cd, delta>diff) as part of developer/full profiles.
Output: Cross-platform installer at `src/install/rust-cli.sh` plus dotfile updates.
</objective>

<execution_context>
@/Users/bragatte/.claude/get-shit-done/workflows/execute-plan.md
@/Users/bragatte/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-linux-enhancements/05-CONTEXT.md
@.planning/phases/05-linux-enhancements/05-RESEARCH.md

Key reference files:
@src/platforms/linux/install/apt.sh (PATTERN REFERENCE)
@src/core/platform.sh (DETECTED_OS)
@src/core/packages.sh (load_packages)
@src/core/idempotent.sh (is_apt_installed, is_brew_installed, is_command_installed)
@data/dotfiles/shared/aliases.sh (MODIFY - eza aliases)
@data/dotfiles/git/gitconfig (MODIFY - add delta config)
@data/dotfiles/bash/bashrc (MODIFY - add zoxide init)
@data/dotfiles/zsh/zshrc (MODIFY - add zoxide init)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create cross-platform Rust CLI tools installer</name>
  <files>src/install/rust-cli.sh</files>
  <action>
  Create directory `src/install/` if it doesn't exist, then create `src/install/rust-cli.sh`.

  Structure follows the data-driven installer pattern but with cross-platform logic:

  1. Header (shebang, description, NOTE about no set -e)
  2. SCRIPT_NAME + SCRIPT_DIR constants
  3. Source core utilities from `${SCRIPT_DIR}/../core/` (one level up, since src/install/ is sibling to src/core/):
     - logging.sh, idempotent.sh, errors.sh, packages.sh, platform.sh

  4. Define the 6 Rust CLI tools as a constant array:
     ```
     RUST_CLI_TOOLS=(bat eza fd-find ripgrep zoxide git-delta)
     ```

  5. Add `show_category_menu()` function (interactive selection):
     - Takes category name and tool list as args
     - Shows: "Install [category]? (tool1, tool2, ...)" with options 1) All 2) Choose 3) Skip
     - `read -rp "Select [1-3]: " choice`
     - Return 0=all, 1=choose, 2=skip
     - In NONINTERACTIVE mode: return 0 (install all)

  6. Add `ask_tool()` function for individual selection:
     - `read -rp "Install $tool? [Y/n]: " answer`
     - Return 0 (yes) unless answer starts with n/N

  7. Add `install_rust_tools_linux()`:
     - For each tool: check `is_apt_installed "$tool"`, skip if installed
     - Install via: `sudo apt-get install -y -o DPkg::Lock::Timeout=60 "$tool"`
     - Track failures

  8. Add `install_rust_tools_macos()`:
     - For each tool: use the brew package names (bat, eza, fd, ripgrep, zoxide, git-delta)
     - Check `brew list "$tool" &>/dev/null`, skip if installed
     - Install via: `brew install "$tool"`
     - No symlinks needed on macOS (brew uses correct names)

  9. Add `create_rust_symlinks()`:
     - Only runs on Linux
     - bat: if `/usr/bin/batcat` exists AND `command -v bat` fails: `sudo ln -sf /usr/bin/batcat /usr/local/bin/bat`
     - fd: if `command -v fdfind` exists AND `command -v fd` fails: `sudo ln -sf "$(which fdfind)" /usr/local/bin/fd`
     - Log each symlink creation with log_ok

  10. Add `show_rust_summary()`:
      - Educational message showing equivalents:
        ```
        log_info "Rust CLI tool equivalents:"
        log_info "  bat  > cat   (syntax highlighting)"
        log_info "  eza  > ls    (modern file listing)"
        log_info "  fd   > find  (fast file search)"
        log_info "  rg   > grep  (fast text search)"
        log_info "  zoxide > cd  (smart directory jumping)"
        log_info "  delta > diff (git-aware diff viewer)"
        ```

  11. Cleanup trap + FAILED_ITEMS

  12. Main section:
      - log_banner "Rust CLI Tools"
      - Interactive selection via show_category_menu
      - Branch on DETECTED_OS: call install_rust_tools_linux or install_rust_tools_macos
      - On Linux: call create_rust_symlinks after install
      - Call show_rust_summary
      - Summary log + exit 0

  NOTE: This installer does NOT use load_packages from a data file. The 6 tools are hardcoded because they're a curated set tied to dotfile configuration, not user-customizable packages.
  </action>
  <verify>Run `bash -n src/install/rust-cli.sh` -- must pass syntax check</verify>
  <done>Cross-platform Rust CLI installer exists with apt/brew branching, Ubuntu symlinks, interactive selection, and educational summary</done>
</task>

<task type="auto">
  <name>Task 2: Update dotfiles for Rust CLI tool integration</name>
  <files>data/dotfiles/shared/aliases.sh, data/dotfiles/git/gitconfig, data/dotfiles/bash/bashrc, data/dotfiles/zsh/zshrc</files>
  <action>
  Make four targeted dotfile updates:

  1. **aliases.sh** - Update eza `ll` alias (line 16):
     - Change: `alias ll="eza -la --git"`
     - To: `alias ll="eza -la --git --group-directories-first"`
     - Leave all other aliases unchanged

  2. **gitconfig** - Add delta pager config. Insert BEFORE the `[color]` section at the end of file:
     ```
     # Delta pager (if installed, git falls back to less if missing)
     [core]
         pager = delta

     [interactive]
         diffFilter = delta --color-only

     [delta]
         navigate = true
         dark = true

     [merge]
         conflictStyle = zdiff3
     ```
     IMPORTANT: gitconfig already has a `[core]` section (line 12) and a `[merge]` section (line 33). Git config files support multiple sections with the same name -- they are merged. But to be clean, ADD the delta-specific `pager` key to the existing `[core]` section (after `whitespace = fix` on line 16) and ADD `conflictStyle` to the existing `[merge]` section (after `ff = only` on line 34). Then add the new `[interactive]` and `[delta]` sections before `[color]`.

  3. **bashrc** - Add zoxide and fnm shell integration. Insert AFTER the fzf line (line 48) and BEFORE the Starship line (line 51):
     ```
     # zoxide (smarter cd)
     command -v zoxide &>/dev/null && eval "$(zoxide init bash)"

     # fnm (Fast Node Manager)
     command -v fnm &>/dev/null && eval "$(fnm env --use-on-cd)"
     ```

  4. **zshrc** - Add zoxide and fnm shell integration. Insert AFTER the fzf line (line 44) and BEFORE the Starship line (line 47):
     ```
     # zoxide (smarter cd)
     command -v zoxide &>/dev/null && eval "$(zoxide init zsh)"

     # fnm (Fast Node Manager)
     command -v fnm &>/dev/null && eval "$(fnm env --use-on-cd)"
     ```
     Note: zoxide init uses `zsh` not `bash` for the zsh config.
  </action>
  <verify>
  Verify each file:
  - `grep "group-directories-first" data/dotfiles/shared/aliases.sh` -- must find the updated alias
  - `grep "delta" data/dotfiles/git/gitconfig` -- must find delta config
  - `grep "zoxide init bash" data/dotfiles/bash/bashrc` -- must find zoxide integration
  - `grep "zoxide init zsh" data/dotfiles/zsh/zshrc` -- must find zoxide integration
  - `grep "fnm env" data/dotfiles/bash/bashrc` -- must find fnm integration
  - `grep "fnm env" data/dotfiles/zsh/zshrc` -- must find fnm integration
  - `bash -n data/dotfiles/bash/bashrc` -- must pass syntax check
  </verify>
  <done>eza alias has --group-directories-first, gitconfig has delta pager config, bashrc and zshrc have zoxide init and fnm env shell integration</done>
</task>

</tasks>

<verification>
- `bash -n src/install/rust-cli.sh` exits 0
- `bash -n data/dotfiles/bash/bashrc` exits 0
- `src/install/rust-cli.sh` contains platform branching on DETECTED_OS
- `src/install/rust-cli.sh` contains `create_rust_symlinks` function
- `data/dotfiles/shared/aliases.sh` contains `--group-directories-first` in ll alias
- `data/dotfiles/git/gitconfig` contains `pager = delta` and `[delta]` section
- `data/dotfiles/bash/bashrc` contains `zoxide init bash` and `fnm env`
- `data/dotfiles/zsh/zshrc` contains `zoxide init zsh` and `fnm env`
</verification>

<success_criteria>
Rust CLI tools have a cross-platform installer. Dotfiles are updated so that once tools are installed, shell integration (zoxide, fnm), git integration (delta), and modern aliases (eza with --group-directories-first) work automatically.
</success_criteria>

<output>
After completion, create `.planning/phases/05-linux-enhancements/05-03-SUMMARY.md`
</output>

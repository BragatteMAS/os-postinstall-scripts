---
phase: 05-linux-enhancements
plan: 05
type: execute
wave: 2
depends_on: ["05-04"]
files_modified:
  - src/install/ai-tools.sh
  - data/packages/ai-tools.txt
  - data/packages/profiles/developer.txt
  - data/packages/profiles/full.txt
autonomous: true

must_haves:
  truths:
    - "AI CLI tools (claude-code, codex, gemini-cli) install via npm install -g"
    - "Ollama installs via official curl script"
    - "Node.js availability is checked before npm-based installs (warn + skip if missing)"
    - "Existing MCP server entries in ai-tools.txt are preserved"
    - "developer.txt includes ai-tools.txt reference"
    - "Ollama model download is offered in interactive mode"
    - "Info message about API keys shown in summary"
  artifacts:
    - path: "src/install/ai-tools.sh"
      provides: "Cross-platform AI tools installer with prefix-based dispatch"
      contains: "npm install -g"
    - path: "data/packages/ai-tools.txt"
      provides: "AI tool entries with npm: and curl: prefixes"
      contains: "npm:@anthropic-ai/claude-code"
    - path: "data/packages/profiles/developer.txt"
      provides: "Developer profile with ai-tools.txt"
      contains: "ai-tools.txt"
  key_links:
    - from: "src/install/ai-tools.sh"
      to: "data/packages/ai-tools.txt"
      via: "load_packages()"
      pattern: "load_packages.*ai-tools"
    - from: "src/install/ai-tools.sh"
      to: "src/core/packages.sh"
      via: "load_packages()"
      pattern: "load_packages"
---

<objective>
Create a cross-platform AI tools installer that handles npm-based CLI tools (claude-code, codex, gemini-cli) and curl-based tools (ollama) using prefix-based dispatch from ai-tools.txt. Update the data file with new entries and add ai-tools.txt to the developer profile.

Purpose: Install AI coding assistants in developer/full profiles so the user has claude, codex, gemini, and ollama available after setup.
Output: AI tools installer at `src/install/ai-tools.sh`, updated ai-tools.txt, updated profile files.
</objective>

<execution_context>
@/Users/bragatte/.claude/get-shit-done/workflows/execute-plan.md
@/Users/bragatte/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-linux-enhancements/05-CONTEXT.md
@.planning/phases/05-linux-enhancements/05-RESEARCH.md

Key reference files:
@src/install/rust-cli.sh (PATTERN REFERENCE - cross-platform installer)
@src/core/packages.sh (load_packages)
@src/core/logging.sh (log_info, log_ok, log_warn, log_error, log_debug, log_banner)
@src/core/errors.sh (record_failure, FAILED_ITEMS)
@data/packages/ai-tools.txt (MODIFY - add AI CLI entries)
@data/packages/profiles/developer.txt (MODIFY - add ai-tools.txt)
@data/packages/profiles/full.txt (REFERENCE - already has ai-tools.txt)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create AI tools installer with prefix-based dispatch</name>
  <files>src/install/ai-tools.sh</files>
  <action>
  Create `src/install/ai-tools.sh`:

  1. Header (shebang, description, NOTE about no set -e)
  2. SCRIPT_NAME + SCRIPT_DIR constants
  3. Source core utilities from `${SCRIPT_DIR}/../core/`: logging.sh, idempotent.sh, errors.sh, packages.sh

  4. Add `show_category_menu()` (same grupo+custom pattern as rust-cli.sh):
     - "Install AI Tools? (claude-code, codex, gemini-cli, ollama)"
     - 1) All 2) Choose 3) Skip
     - NONINTERACTIVE: return 0 (install all)

  5. Add `ask_tool()` for individual selection

  6. Add `install_ai_tool()` function:
     - Parse prefix: `local prefix="${entry%%:*}"` and `local tool="${entry#*:}"`
     - Case on prefix:
       - `npm)`: Check `command -v node` first. If missing: `log_warn "Node.js not found, skipping npm tool: $tool"`, return 1. Otherwise: `npm install -g "$tool"`. Check binary exists after install.
       - `curl)`: Case on tool name:
         - `ollama)`: Check `command -v ollama` first (idempotent). If missing: `curl -fsSL https://ollama.com/install.sh | sh`. Ollama requires sudo (the script handles it).
       - `npx|uv)`: `log_debug "Skipping $prefix tool (runs on demand): $tool"`, return 0
       - `*)`: `log_warn "Unknown prefix: $prefix for $tool"`, return 1

  7. Add `offer_ollama_model()` function:
     - Only in interactive mode (skip if NONINTERACTIVE=true)
     - Check `command -v ollama` or return
     - Ask: "Download a base model? 1) llama3 2) Skip"
     - `read -rp "Select [1-2]: " choice`
     - If 1: `ollama pull llama3.2` (use latest lightweight model)

  8. Add `show_ai_summary()`:
     - `log_info "Configure API keys for AI tools:"`
     - `log_info "  ANTHROPIC_API_KEY - for Claude Code"`
     - `log_info "  OPENAI_API_KEY   - for Codex"`
     - `log_info "  GEMINI_API_KEY   - for Gemini CLI"`

  9. Cleanup trap + FAILED_ITEMS

  10. Main section:
      - log_banner "AI Coding Tools"
      - Interactive menu (show_category_menu)
      - If skip: exit 0
      - load_packages "ai-tools.txt"
      - Filter only `npm:` and `curl:` entries (the installable ones)
      - If "choose" mode: ask_tool for each installable entry
      - Install loop: call install_ai_tool for each selected entry, record_failure on failure
      - Call offer_ollama_model
      - Call show_ai_summary
      - Summary log + exit 0
  </action>
  <verify>Run `bash -n src/install/ai-tools.sh` -- must pass syntax check. Verify file contains `npm install -g` and `ollama.com/install.sh`.</verify>
  <done>AI tools installer handles npm:, curl:, npx:, uv: prefixes with idempotent checks, interactive selection, ollama model download offer, and API key info summary</done>
</task>

<task type="auto">
  <name>Task 2: Update ai-tools.txt and profile files</name>
  <files>data/packages/ai-tools.txt, data/packages/profiles/developer.txt, data/packages/profiles/full.txt</files>
  <action>
  1. **ai-tools.txt** - Add AI CLI entries. Keep ALL existing content (MCP servers). Add new section BEFORE the existing MCP entries:

     ```
     # AI CLI Tools (via npm)
     npm:@anthropic-ai/claude-code
     npm:@openai/codex
     npm:@google/gemini-cli

     # Local LLM Runtime (via curl)
     curl:ollama

     ```
     Then keep ALL existing entries below (MCP Servers, Python Tools, etc.)

  2. **developer.txt** - Add ai-tools.txt and new package file references. Update to:
     ```
     # Developer profile - system + development tools
     # Platform-agnostic: each main.sh filters to relevant files

     # Linux
     apt.txt
     apt-post.txt

     # macOS
     brew.txt
     brew-cask.txt

     # Cross-platform
     cargo.txt
     npm.txt
     ai-tools.txt

     # Linux-only (skipped on macOS)
     flatpak.txt
     snap.txt
     ```

  3. **full.txt** - Add missing package file references. Update to:
     ```
     # Full profile - all packages including AI tools
     # Platform-agnostic: each main.sh filters to relevant files

     # Linux
     apt.txt
     apt-post.txt

     # macOS
     brew.txt
     brew-cask.txt

     # Cross-platform
     cargo.txt
     npm.txt
     ai-tools.txt

     # Linux-only (skipped on macOS)
     flatpak.txt
     flatpak-post.txt
     snap.txt
     snap-post.txt
     ```
  </action>
  <verify>
  - `grep "npm:@anthropic-ai/claude-code" data/packages/ai-tools.txt` -- must find entry
  - `grep "curl:ollama" data/packages/ai-tools.txt` -- must find entry
  - `grep "npx:@context7/mcp-server" data/packages/ai-tools.txt` -- must find existing MCP entry (preserved)
  - `grep "ai-tools.txt" data/packages/profiles/developer.txt` -- must find reference
  - `grep "apt-post.txt" data/packages/profiles/developer.txt` -- must find reference
  - `grep "flatpak-post.txt" data/packages/profiles/full.txt` -- must find reference
  - `grep "snap-post.txt" data/packages/profiles/full.txt` -- must find reference
  </verify>
  <done>ai-tools.txt has AI CLI entries (npm: and curl: prefixes) with existing MCP entries preserved. developer.txt includes ai-tools.txt. Both developer.txt and full.txt have apt-post.txt, flatpak, and snap references.</done>
</task>

</tasks>

<verification>
- `bash -n src/install/ai-tools.sh` exits 0
- ai-tools.txt contains all 4 AI CLI entries (3 npm + 1 curl) AND all original MCP entries
- developer.txt contains ai-tools.txt
- full.txt contains flatpak-post.txt and snap-post.txt
- ai-tools.sh checks `command -v node` before npm operations
- ai-tools.sh contains API key info message
- No file contains `set -e`
</verification>

<success_criteria>
AI tools installer handles prefix-based dispatch (npm/curl/npx/uv), checks Node.js availability before npm installs, offers ollama model download interactively, shows API key configuration info, and profile files correctly reference all package files for both platforms.
</success_criteria>

<output>
After completion, create `.planning/phases/05-linux-enhancements/05-05-SUMMARY.md`
</output>

---
phase: 05-linux-enhancements
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - src/install/fnm.sh
  - src/install/uv.sh
  - src/install/dev-env.sh
autonomous: true

must_haves:
  truths:
    - "fnm is installed via curl script and Node LTS is available"
    - "uv is installed via curl script and Python is available"
    - "Global npm packages (pnpm, bun) are installed after Node"
    - "SSH key generation is offered in interactive mode (default=No)"
    - "All installers are cross-platform (work on Linux and macOS)"
    - "Interactive selection model: grupo+custom for tool categories"
  artifacts:
    - path: "src/install/fnm.sh"
      provides: "Cross-platform fnm installer"
      contains: "fnm.vercel.app"
    - path: "src/install/uv.sh"
      provides: "Cross-platform uv installer"
      contains: "astral.sh/uv"
    - path: "src/install/dev-env.sh"
      provides: "Dev environment orchestrator (fnm + uv + globals + SSH)"
      contains: "install_fnm"
  key_links:
    - from: "src/install/dev-env.sh"
      to: "src/install/fnm.sh"
      via: "source or bash call"
      pattern: "fnm.sh"
    - from: "src/install/dev-env.sh"
      to: "src/install/uv.sh"
      via: "source or bash call"
      pattern: "uv.sh"
---

<objective>
Create cross-platform development environment installers: fnm (Node.js version manager), uv (Python package/version manager), and a dev-env.sh orchestrator that coordinates installation of both plus Node LTS, Python, pnpm, bun, and optional SSH key generation.

Purpose: Provide a complete dev environment setup in developer/full profiles that works on both Linux and macOS.
Output: Three installer scripts in `src/install/`.
</objective>

<execution_context>
@/Users/bragatte/.claude/get-shit-done/workflows/execute-plan.md
@/Users/bragatte/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-linux-enhancements/05-CONTEXT.md
@.planning/phases/05-linux-enhancements/05-RESEARCH.md

Key reference files:
@src/install/rust-cli.sh (PATTERN REFERENCE - cross-platform installer from 05-03, may not exist yet)
@src/core/logging.sh (log_info, log_ok, log_warn, log_error, log_debug, log_banner)
@src/core/idempotent.sh (is_command_installed)
@src/core/errors.sh (record_failure, FAILED_ITEMS)
@data/dotfiles/shared/path.sh (PATH management - fnm and uv add to PATH)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create fnm and uv installers</name>
  <files>src/install/fnm.sh, src/install/uv.sh</files>
  <action>
  Create `src/install/` directory if it doesn't exist.

  **fnm.sh** - Cross-platform fnm installer:

  1. Header (shebang, description, NOTE about no set -e)
  2. SCRIPT_NAME + SCRIPT_DIR constants
  3. Source core utilities from `${SCRIPT_DIR}/../core/`: logging.sh, errors.sh
  4. `install_fnm()` function:
     - Idempotent: `command -v fnm &>/dev/null` -> log_debug "already installed", return 0
     - log_info "Installing fnm (Fast Node Manager)..."
     - `curl -fsSL https://fnm.vercel.app/install | bash -s -- --skip-shell`
     - `--skip-shell` prevents fnm from modifying shell configs (we handle that in dotfiles)
     - After install, add to PATH for current session: `export PATH="$HOME/.local/share/fnm:$PATH"`
     - Source fnm env for current session: `eval "$(fnm env)"`
     - Verify: `command -v fnm` or log_error and return 1
     - log_ok "fnm installed: $(fnm --version)"
  5. `install_node_lts()` function:
     - Check if fnm available: `command -v fnm` or log_warn and return 1
     - `fnm install --lts`
     - `fnm default lts-latest` (set as default)
     - Verify: `command -v node` or log_warn and return 1
     - log_ok "Node.js $(node --version) installed via fnm"
  6. `install_global_npm()` function:
     - Check `command -v npm` or warn and return
     - Install pnpm: `npm install -g pnpm`
     - Install bun: `npm install -g bun`
     - log_ok for each successful install
  7. Cleanup trap
  8. Main section (when run directly, not sourced):
     - Use main guard: `if [[ "${BASH_SOURCE[0]}" == "$0" ]]`
     - log_banner "fnm - Fast Node Manager"
     - Call install_fnm, install_node_lts, install_global_npm
     - exit 0

  **uv.sh** - Cross-platform uv installer:

  1. Same header/sourcing pattern
  2. `install_uv()` function:
     - Idempotent: `command -v uv &>/dev/null` -> log_debug "already installed", return 0
     - log_info "Installing uv (Python package manager)..."
     - `curl -LsSf https://astral.sh/uv/install.sh | sh`
     - Add to PATH for current session: `export PATH="$HOME/.local/bin:$PATH"`
     - Verify: `command -v uv` or log_error and return 1
     - log_ok "uv installed: $(uv --version)"
  3. `install_python()` function:
     - Check `command -v uv` or warn and return
     - `uv python install` (installs latest stable)
     - log_ok "Python installed via uv"
  4. Cleanup trap
  5. Main section with main guard:
     - log_banner "uv - Python Package Manager"
     - Call install_uv, install_python
     - exit 0
  </action>
  <verify>
  Run `bash -n src/install/fnm.sh` and `bash -n src/install/uv.sh` -- both must pass syntax check.
  Verify fnm.sh contains `--skip-shell` flag.
  Verify uv.sh contains `astral.sh/uv/install.sh`.
  </verify>
  <done>fnm.sh installs fnm + Node LTS + pnpm + bun. uv.sh installs uv + Python. Both are idempotent, cross-platform, and can be sourced or run directly.</done>
</task>

<task type="auto">
  <name>Task 2: Create dev-env orchestrator with interactive selection and SSH</name>
  <files>src/install/dev-env.sh</files>
  <action>
  Create `src/install/dev-env.sh` as the orchestrator for dev environment setup:

  1. Header (shebang, description, NOTE about no set -e)
  2. SCRIPT_NAME + SCRIPT_DIR constants
  3. Source core utilities from `${SCRIPT_DIR}/../core/`: logging.sh, errors.sh
  4. Source sub-installers (for their functions, not main execution):
     - `source "${SCRIPT_DIR}/fnm.sh"` (functions become available due to main guard)
     - `source "${SCRIPT_DIR}/uv.sh"` (same)

  5. Add `show_category_menu()` if not already defined (same pattern as rust-cli.sh):
     - "Install [category]? (items)" with 1) All 2) Choose 3) Skip
     - NONINTERACTIVE mode: return 0 (install all)

  6. Add `ask_tool()` for individual tool selection

  7. Add `setup_ssh_key()`:
     - In NONINTERACTIVE mode: skip entirely (log_debug "Skipping SSH key generation (non-interactive)")
     - Interactive: `read -rp "Generate SSH key for GitHub? [y/N]: " answer`
     - Default is No (return unless answer starts with y/Y)
     - If yes: `ssh-keygen -t ed25519 -C "${USER}@$(hostname)" -f "$HOME/.ssh/id_ed25519"`
     - Check if key already exists first (idempotent)
     - Log the public key path for user to copy

  8. Cleanup trap + FAILED_ITEMS

  9. Main section:
     - log_banner "Development Environment"
     - Interactive menu for "Node.js (fnm + pnpm + bun)" and "Python (uv)"
     - Based on selection, call:
       - fnm: install_fnm + install_node_lts + install_global_npm
       - uv: install_uv + install_python
     - Call setup_ssh_key (asks only in interactive mode)
     - Summary: log tools installed and their versions
     - log_info "Shell integration loaded on next terminal session (fnm env, zoxide init)"
     - exit 0
  </action>
  <verify>Run `bash -n src/install/dev-env.sh` -- must pass syntax check. Verify the file sources fnm.sh and uv.sh.</verify>
  <done>dev-env.sh orchestrates fnm + uv installation with interactive selection, Node LTS + pnpm + bun setup, Python setup, and optional SSH key generation</done>
</task>

</tasks>

<verification>
- `bash -n src/install/fnm.sh` exits 0
- `bash -n src/install/uv.sh` exits 0
- `bash -n src/install/dev-env.sh` exits 0
- fnm.sh contains `fnm.vercel.app` and `--skip-shell`
- uv.sh contains `astral.sh/uv/install.sh`
- dev-env.sh sources both fnm.sh and uv.sh
- dev-env.sh contains SSH key generation logic
- All three files source from `${SCRIPT_DIR}/../core/`
- No file contains `set -e`
</verification>

<success_criteria>
Dev environment setup provides fnm (Node.js via LTS + pnpm + bun) and uv (Python) with interactive selection. SSH key generation offered interactively. All installers are cross-platform and idempotent. Functions can be sourced by other scripts.
</success_criteria>

<output>
After completion, create `.planning/phases/05-linux-enhancements/05-04-SUMMARY.md`
</output>

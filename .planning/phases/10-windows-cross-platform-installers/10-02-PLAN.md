---
phase: 10-windows-cross-platform-installers
plan: 02
type: execute
wave: 2
depends_on: ["10-01"]
files_modified:
  - src/platforms/windows/main.ps1
  - tests/test-windows.ps1
autonomous: true

must_haves:
  truths:
    - "main.ps1 dispatches cargo.txt to cargo.ps1 (not WARN skip)"
    - "main.ps1 dispatches npm.txt to npm.ps1 (not WARN skip)"
    - "main.ps1 dispatches ai-tools.txt to ai-tools.ps1 (not WARN skip)"
    - "test-windows.ps1 validates all three new installer scripts exist and have correct patterns"
  artifacts:
    - path: "src/platforms/windows/main.ps1"
      provides: "Updated dispatch switch with cargo/npm/ai-tools routing"
      contains: "install/cargo.ps1"
    - path: "tests/test-windows.ps1"
      provides: "Extended test suite covering new installer scripts"
      contains: "cargo.ps1 exists"
  key_links:
    - from: "src/platforms/windows/main.ps1"
      to: "src/platforms/windows/install/cargo.ps1"
      via: "& operator dispatch"
      pattern: "install/cargo\\.ps1"
    - from: "src/platforms/windows/main.ps1"
      to: "src/platforms/windows/install/npm.ps1"
      via: "& operator dispatch"
      pattern: "install/npm\\.ps1"
    - from: "src/platforms/windows/main.ps1"
      to: "src/platforms/windows/install/ai-tools.ps1"
      via: "& operator dispatch"
      pattern: "install/ai-tools\\.ps1"
---

<objective>
Wire the three new installer scripts into the Windows orchestrator and extend the test suite.

Purpose: Replace the WARN-skip placeholders in main.ps1 with actual dispatch calls to cargo.ps1, npm.ps1, and ai-tools.ps1. Extend test-windows.ps1 to validate the new scripts exist and have correct patterns.

Output: Modified main.ps1 (dispatch wiring) and test-windows.ps1 (extended coverage).
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-windows-cross-platform-installers/10-RESEARCH.md
@.planning/phases/10-windows-cross-platform-installers/10-01-SUMMARY.md

# Files being modified
@src/platforms/windows/main.ps1
@tests/test-windows.ps1

# New scripts being wired in (from Plan 01)
@src/platforms/windows/install/cargo.ps1
@src/platforms/windows/install/npm.ps1
@src/platforms/windows/install/ai-tools.ps1
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update main.ps1 dispatch to call new installers</name>
  <files>src/platforms/windows/main.ps1</files>
  <action>
Modify `src/platforms/windows/main.ps1` to replace the three WARN-skip blocks with actual dispatch calls.

In the `Install-Profile` function, the `switch ($pkgFile)` block currently has:

```powershell
'cargo.txt' {
    Write-Log -Level WARN -Message 'cargo.txt: Windows Cargo installer not yet implemented (skipping)'
}
'npm.txt' {
    Write-Log -Level WARN -Message 'npm.txt: Windows npm installer not yet implemented (skipping)'
}
'ai-tools.txt' {
    Write-Log -Level WARN -Message 'ai-tools.txt: Windows AI tools installer not yet implemented (skipping)'
}
```

Replace each with actual dispatch following the exact pattern used for winget.txt:

```powershell
'cargo.txt' {
    Write-Log -Level INFO -Message 'Installing Cargo packages...'
    & "$WindowsDir/install/cargo.ps1"
}
'npm.txt' {
    Write-Log -Level INFO -Message 'Installing NPM global packages...'
    & "$WindowsDir/install/npm.ps1"
}
'ai-tools.txt' {
    Write-Log -Level INFO -Message 'Installing AI tools...'
    & "$WindowsDir/install/ai-tools.ps1"
}
```

Also update the script header comment (line 11) from "Dispatches winget.txt to winget.ps1" to "Dispatches winget.txt, cargo.txt, npm.txt, ai-tools.txt to platform installers".

**Do NOT** change any other part of main.ps1. The function structure, menu, parameters, and unattended/interactive logic remain unchanged.
  </action>
  <verify>
Verify in main.ps1:
- No WARN lines remain for cargo.txt, npm.txt, or ai-tools.txt
- Contains `& "$WindowsDir/install/cargo.ps1"` in the cargo.txt case
- Contains `& "$WindowsDir/install/npm.ps1"` in the npm.txt case
- Contains `& "$WindowsDir/install/ai-tools.ps1"` in the ai-tools.txt case
- winget.txt dispatch unchanged
- default case (non-Windows files) unchanged
  </verify>
  <done>main.ps1 dispatches cargo.txt, npm.txt, and ai-tools.txt to their respective installers instead of WARN-skipping</done>
</task>

<task type="auto">
  <name>Task 2: Extend test-windows.ps1 with new installer tests</name>
  <files>tests/test-windows.ps1</files>
  <action>
Extend `tests/test-windows.ps1` to validate the three new installer scripts. Add tests in the established pattern (Assert-Pass for existence, Assert-Contains for content patterns, Assert-NotContains for anti-patterns).

**Add to section 1 (File existence checks):**
```powershell
Assert-Pass "cargo.ps1 exists" {
    if (-not (Test-Path "$ProjectRoot/src/platforms/windows/install/cargo.ps1")) { throw "missing" }
}
Assert-Pass "npm.ps1 exists" {
    if (-not (Test-Path "$ProjectRoot/src/platforms/windows/install/npm.ps1")) { throw "missing" }
}
Assert-Pass "ai-tools.ps1 exists" {
    if (-not (Test-Path "$ProjectRoot/src/platforms/windows/install/ai-tools.ps1")) { throw "missing" }
}
```

**Add to section 2 (Content checks):**
```powershell
# cargo.ps1 content
Assert-Contains "WinGetMap in cargo.ps1" "$ProjectRoot/src/platforms/windows/install/cargo.ps1" "WinGetMap"
Assert-Contains "Read-PackageFile cargo.txt in cargo.ps1" "$ProjectRoot/src/platforms/windows/install/cargo.ps1" "Read-PackageFile.*cargo\.txt"
Assert-Contains "zellij skip in cargo.ps1" "$ProjectRoot/src/platforms/windows/install/cargo.ps1" "zellij"
Assert-Contains "DRY_RUN in cargo.ps1" "$ProjectRoot/src/platforms/windows/install/cargo.ps1" "DRY_RUN"

# npm.ps1 content
Assert-Contains "npm install -g in npm.ps1" "$ProjectRoot/src/platforms/windows/install/npm.ps1" "npm install -g"
Assert-Contains "Read-PackageFile npm.txt in npm.ps1" "$ProjectRoot/src/platforms/windows/install/npm.ps1" "Read-PackageFile.*npm\.txt"
Assert-Contains "node check in npm.ps1" "$ProjectRoot/src/platforms/windows/install/npm.ps1" "Get-Command node"
Assert-Contains "DRY_RUN in npm.ps1" "$ProjectRoot/src/platforms/windows/install/npm.ps1" "DRY_RUN"

# ai-tools.ps1 content
Assert-Contains "prefix dispatch in ai-tools.ps1" "$ProjectRoot/src/platforms/windows/install/ai-tools.ps1" "switch.*prefix"
Assert-Contains "Ollama WinGet in ai-tools.ps1" "$ProjectRoot/src/platforms/windows/install/ai-tools.ps1" "Ollama\.Ollama"
Assert-Contains "Read-PackageFile ai-tools in ai-tools.ps1" "$ProjectRoot/src/platforms/windows/install/ai-tools.ps1" "Read-PackageFile.*ai-tools\.txt"
Assert-Contains "DRY_RUN in ai-tools.ps1" "$ProjectRoot/src/platforms/windows/install/ai-tools.ps1" "DRY_RUN"

# main.ps1 dispatch (replaces WARN checks)
Assert-Contains "cargo dispatch in main.ps1" "$ProjectRoot/src/platforms/windows/main.ps1" "install/cargo\.ps1"
Assert-Contains "npm dispatch in main.ps1" "$ProjectRoot/src/platforms/windows/main.ps1" "install/npm\.ps1"
Assert-Contains "ai-tools dispatch in main.ps1" "$ProjectRoot/src/platforms/windows/main.ps1" "install/ai-tools\.ps1"
```

**Add to section 3 (Anti-pattern checks):**
```powershell
Assert-NotContains "no WARN skip for cargo in main.ps1" "$ProjectRoot/src/platforms/windows/main.ps1" "Cargo installer not yet implemented"
Assert-NotContains "no WARN skip for npm in main.ps1" "$ProjectRoot/src/platforms/windows/main.ps1" "npm installer not yet implemented"
Assert-NotContains "no WARN skip for ai-tools in main.ps1" "$ProjectRoot/src/platforms/windows/main.ps1" "AI tools installer not yet implemented"
```

This adds approximately 20 new tests (3 existence + 12 content + 3 dispatch + 3 anti-pattern - some overlap with updated existing checks). The existing 18 tests remain unchanged.

**Do NOT** modify the test harness functions (Assert-Pass, Assert-Contains, Assert-NotContains) or the summary section. Only add new test assertions.
  </action>
  <verify>
Verify in test-windows.ps1:
- Contains Assert-Pass checks for cargo.ps1, npm.ps1, ai-tools.ps1 existence
- Contains Assert-Contains checks for WinGetMap, npm install -g, prefix dispatch, Ollama.Ollama
- Contains Assert-NotContains checks for the old WARN skip messages
- Contains Assert-Contains checks for dispatch paths in main.ps1 (install/cargo.ps1, install/npm.ps1, install/ai-tools.ps1)
- All original 18 tests still present
- Total test count is approximately 38
  </verify>
  <done>test-windows.ps1 extended with ~20 new tests covering file existence, content patterns, dispatch wiring, and anti-patterns for all three new installer scripts</done>
</task>

</tasks>

<verification>
Phase 10 success criteria check:
1. Windows main.ps1 dispatches cargo.txt to cargo.ps1 (not WARN skip) -- verified by Assert-Contains + Assert-NotContains
2. Windows main.ps1 dispatches npm.txt to npm.ps1 (not WARN skip) -- verified by Assert-Contains + Assert-NotContains
3. Windows main.ps1 dispatches ai-tools.txt to ai-tools.ps1 (not WARN skip) -- verified by Assert-Contains + Assert-NotContains
4. Developer/full profiles on Windows install all listed packages -- verified by dispatch wiring + each script loading its .txt file
</verification>

<success_criteria>
- main.ps1 has zero WARN-skip blocks for cargo.txt, npm.txt, ai-tools.txt
- main.ps1 dispatches all three to their respective install/*.ps1 scripts via & operator
- test-windows.ps1 has ~38 tests (18 original + ~20 new) all validating Phase 10 deliverables
- Running test-windows.ps1 on a machine with the files present would pass all static checks
</success_criteria>

<output>
After completion, create `.planning/phases/10-windows-cross-platform-installers/10-02-SUMMARY.md`
</output>

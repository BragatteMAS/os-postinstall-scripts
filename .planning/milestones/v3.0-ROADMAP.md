# Milestone Archive: v3.0 Quality & Parity

**Shipped:** 2026-02-18
**Tag:** v4.0.0
**Scope:** Phases 11-14 (4 phases, 7 plans, 29 commits)
**Git Range:** 4bb0f39..1635ec5

---

## Key Accomplishments

1. **Corrigidos bugs de flag/boolean** — VERBOSE boolean fix em logging.sh (5 locations), NONINTERACTIVE bridge unificado, remocao de pacote stale (kite.kite), docs alinhados com ADR-001
2. **Eliminadas duplicacoes PowerShell** — Extracao de Test-WinGetInstalled/Test-NpmInstalled/Test-CargoInstalled para idempotent.psm1 compartilhado (-59 linhas)
3. **Estrutura DRY consolidada** — Merge src/installers/ -> src/install/, cores duplicadas removidas de platform.sh (SSoT em logging.sh), DATA_DIR readonly guard
4. **Windows UX parity alcancada** — CLI switches (-DryRun, -Verbose, -Unattended), [Step X/Y] counters, completion summary, [CmdletBinding()] em 9 exported functions
5. **Suite de testes criada** — 37 bats-core unit tests cobrindo 4 core modules + lint runners (ShellCheck + PSScriptAnalyzer)
6. **Documentacao completada** — EXTRA_PACKAGES/SKIP_PACKAGES docs + 2 Windows troubleshooting items no README

---

## Metrics

| Metric | Value |
|--------|-------|
| Phases | 4 (11-14) |
| Plans executed | 7 |
| Commits | 29 |
| Files changed | 67 |
| Lines added | 6,556 |
| Lines removed | 2,164 |
| Requirements satisfied | 16/16 (100%) |
| Tests added | 37 bats + 2 lint runners |
| Total execution time | ~17 min |
| Average per plan | ~2.4 min |
| Period | 2026-02-17 to 2026-02-18 |

---

## Phase Details

### Phase 11: Flag & Boolean Fixes
**Goal**: Correct flag semantics so VERBOSE, NONINTERACTIVE, and data files behave as documented
**Depends on**: Phase 10.1
**Requirements**: FLAG-01, FLAG-02, FLAG-03, FLAG-04
**Success Criteria** (what must be TRUE):
  1. Running with `VERBOSE=false ./setup.sh` produces no timestamp/debug output (boolean check uses `== "true"`, not `-n`)
  2. Running with `./setup.sh -y` suppresses all interactive prompts including apt confirmation (NONINTERACTIVE/UNATTENDED unified via bridge)
  3. Running `.\setup.ps1` on Windows does not attempt to install kite.kite (stale entry removed from winget.txt)
  4. ARCHITECTURE.md accurately describes the error handling strategy (no set -e, per ADR-001)
**Plans**: 1 plan
**Status**: Complete (2026-02-18)

Plans:
- [x] 11-01-PLAN.md -- Fix VERBOSE boolean, NONINTERACTIVE bridge, stale winget entry, and doc drift

### Phase 12: Structure & DRY Cleanup
**Goal**: Eliminate code duplication and unify directory structure so each concept has exactly one home
**Depends on**: Phase 11
**Requirements**: DRY-01, DRY-02, DRY-03, DRY-04
**Success Criteria** (what must be TRUE):
  1. Test-WinGetInstalled and Test-NpmInstalled exist in exactly one file (windows/core/idempotent.psm1) and all PS installers import from there
  2. Only one install directory exists under src/ (src/install/, not both src/install/ and src/installers/)
  3. Color/format variables are defined only in logging.sh (platform.sh has no independent color definitions)
  4. Running `./setup.sh` twice does not hit a readonly DATA_DIR collision error (guard protects re-source)
**Plans**: 2 plans
**Status**: Complete (2026-02-18)

Plans:
- [x] 12-01-PLAN.md -- Extract PS idempotent check functions to shared idempotent.psm1 module (DRY-01)
- [x] 12-02-PLAN.md -- Merge install directories, eliminate platform.sh color duplication, guard DATA_DIR readonly (DRY-02, DRY-03, DRY-04)

### Phase 13: Windows Parity
**Goal**: Windows users see the same UX feedback as Unix users (flags, progress, summary)
**Depends on**: Phase 12
**Requirements**: WPAR-01, WPAR-02, WPAR-03, WPAR-04
**Success Criteria** (what must be TRUE):
  1. Running `.\setup.ps1 -DryRun` shows a DryRun banner and skips all mutations (matching Bash `--dry-run` behavior)
  2. Windows installation shows `[Step X/Y]` prefix for each dispatch step (matching Unix step counters)
  3. After Windows setup completes, user sees a summary with profile name, platform, duration, and failure count (matching Unix completion summary)
  4. All exported PowerShell functions use `[CmdletBinding()]` so `-Verbose` and `-Debug` propagate natively
**Plans**: 2 plans
**Status**: Complete (2026-02-18)

Plans:
- [x] 13-01-PLAN.md -- CLI flags + progress.psm1 module + step counters + completion summary (WPAR-01, WPAR-02, WPAR-03)
- [x] 13-02-PLAN.md -- CmdletBinding for all core module exported functions (WPAR-04)

### Phase 14: Testing & Documentation
**Goal**: Validate final codebase correctness with unit tests and close documentation gaps
**Depends on**: Phase 13
**Requirements**: TEST-01, TEST-02, DOC-01, DOC-02
**Success Criteria** (what must be TRUE):
  1. Running `bats tests/test-core-*.bats` passes unit tests for logging.sh, errors.sh, packages.sh, and idempotent.sh
  2. Running `tools/lint.sh` executes ShellCheck on all .sh files and reports results (no CI required)
  3. README.md Customization section documents EXTRA_PACKAGES and SKIP_PACKAGES environment variables with examples
  4. README.md includes a Windows Troubleshooting section covering execution policy, WinGet availability, and PATH issues
**Plans**: 2 plans
**Status**: Complete (2026-02-18)

Plans:
- [x] 14-01-PLAN.md -- bats-core unit tests for 4 core modules + ShellCheck/PSScriptAnalyzer lint runners (TEST-01, TEST-02)
- [x] 14-02-PLAN.md -- README: EXTRA_PACKAGES/SKIP_PACKAGES docs + Windows Troubleshooting sections (DOC-01, DOC-02)

---

## Tech Debt Carried Forward

| Item | Severity | Notes |
|------|----------|-------|
| 13 pre-existing ShellCheck findings | INFO | SC2329, SC2086, SC2012 -- not introduced by v3.0 |
| EXTRA_PACKAGES/SKIP_PACKAGES not consumed | INFO | Declared but no installer reads them. Documented honestly |
| Terminal screenshot for README | DEFERRED | Needs asciinema + agg setup |
| Social preview image | DEFERRED | Via socialify.git.ci |

---

## Audit Result

**Status:** PASSED (2026-02-18)
**Score:** 21/21 must-haves verified across all phases
**Integration:** 18 wiring points confirmed, 0 orphaned, 0 missing
**E2E Flows:** 4/4 complete (Unix setup, Windows setup, test execution, lint execution)

See: `.planning/v3.0-MILESTONE-AUDIT.md` for full audit report.

---

*Archived: 2026-02-18*
*Previous milestones: v1.0 MVP (2026-02-08), v2.1 Feature Completion (2026-02-17)*
